\include{settings}

\begin{document}

\include{title}

\tableofcontents
\newpage

\section{Программа работы}

\begin{enumerate}
	\item Осуществить переход от многокритериальной задачи к однокритериальной с использованием следующих подходов.  Сформировать множество Парето из всех решений, полученных в результате выполнения этого пункта.
		\begin{enumerate}
			\item Выделение главного критерия.
			\item Свертка критериев (аддитивная и мультипликативная).
			\item Максимин или минимакс (он же метод максиминной свертки).
			\item Метод последовательных уступок.
			\item Метод достижения цели (\code{fgoalattain}). 
			\item Ведение метрики в пространстве критериев.
		\end{enumerate}
%	\item Выбрать одну из однокритериальных задач.
%		\begin{enumerate}
%			\item Привести подробную математическую модель выбранной задачи.
%			\item Проанализировать полученное решение:\\
%			Найти левые части ограничений задачи для полученного решения (численные значения).\\
%			Обозначить активные ограничения задачи.\\
%			Выбрать одно из активных ограничений задачи для преобразования в вероятностное: 
%			$P\left( \sum_{j=1}^n a_{ij} x_j - b_i \leq 0 \right) \geq \alpha_i$.\\
%			Решить задачу полученную задачу стохастического программирования, меняя $\alpha_i$ в следующем диапазоне: $0.1 \leq \alpha_i \leq 0.9$.\\
%			Считать случайной величиной $b_i$ или элементы $\{a_{ij}\}$ $i$-й строки матрицы    (по выбору).
%		\end{enumerate}
\end{enumerate}

\section{Постановка задачи}

Необходимо создать смесь для приготовления докторской колбасы.
По ГОСТу массовая доля должна быть: влаги – не более $65\%$, соли – не более $2.1\%$, жира – не более $22\%$, белка – не менее $13\%$.
Для достижения хорошего вкуса необходимо соблюдать следующие пропорции: жира должно быть больше белка, отношение жира к влаге $\leq 1$, отношение белка к соли $\leq 10$.
Необходимо максимизировать количество белка в продукте и калорийность продукта в целом. Минимизировать – количество жира и стоимость.
Стоимость воды условно бесплатно, соли – $0.01$, жира – $0.1$, белка – $1$. Калорийность жира – $200$ ккал, белка – $100$ ккал.

\newpage

\section{Математическая модель}

\noindent Составим математическую модель задачи. Для определенности ограничим минимальные доли влаги, соли и белка $1$, а максимальную долю белка -- $99$. Обозначим переменные: $x_1$ – влага, $x_2$ – соль, $x_3$ – жир, $x_4$ – белок. С учетом требований пакета MATLAB к постановке задач оптимизации, необходимо представить целевые функции как поиск минимумов, а ограничения записать в виде $g(x) \leq 0$, поэтому преобразуем исходные ограничения.

\begin{equation*}
	\begin{aligned}[c]
		\begin{cases}
		\max(x_4) \\
		\max(200 \cdot x_3 + 100 \cdot x_4) \\
		\min(x_3) \\
		\min(0.01 \cdot x_2 + 0.1 \cdot x_3 + 1 \cdot x_4) \\
		x_1 + x_2 + x_3 + x_4 = 100 \\
		1 \leq x_1 \leq 65 \\
		1 \leq x_2 \leq 2.1 \\
		1 \leq x_3 \leq 22 \\
		13 \leq x_4 \leq 99 \\
		x_3 \geq x_4 \\
		\dfrac{x_3}{x_1} \leq 1 \\
		\dfrac{x_4}{x_2} \leq 10
		\end{cases}
	\end{aligned}
	\leftrightarrow
	\begin{aligned}[c]
		\begin{cases}
		\min(-x_4) = \min(f_1) \\
		\min(-200 \cdot x_3 - 100 \cdot x_4) = \min(f_2) \\
		\min(x_3) = \min(f_3) \\
		\min(0.01 \cdot x_2 + 0.1 \cdot x_3 + 1 \cdot x_4) = \min(f_4) \\
		x_1 + x_2 + x_3 + x_4 - 100 = 0 \\
		1 - x_1 \leq 0 \\
		x_1 - 65 \leq 0 \\
		1 - x_2 \leq 0 \\
		x_2 - 2.1 \leq 0 \\
		1 - x_3 \leq 0 \\
		x_3 - 22 \leq 0 \\
		13 - x_4 \leq 0 \\
		x_4 - 99 \leq 0 \\
		x_4 - x_3 \leq 0 \\
		x_3 - x_1 \leq 0 \\
		x_4 - 10 \cdot x_2 \leq 0
		\end{cases}
	\end{aligned}
\end{equation*}

\newpage

\section{Поиск оптимумов частных критериев}
Найдем оптимумы каждой из целевых функций независимо от других. Для этого необходимо решить четыре задачи однокритериальной оптимизации: для $f_i$, $i \in \{1,2,3,4\}$ при тех же ограничениях на $x_j$, $j \in \{1, 2, 3, 4\}$, что имеют место для задачи многокритериальной оптимизации.

\lstinputlisting[caption=\code{model.m}]{model.m}

\begin{lstlisting}[caption=\code{Console}]
>> model
>> [x, f] = fmincon(f1, lb, A, b, Aeq, beq, lb, ub)
x =
	55.2483    2.1000   21.6517   21.0000
f =	-21.0000
>> fmincon(f2, lb, A, b, Aeq, beq, lb, ub)
x =
	54.9000    2.1000   22.0000   21.0000
f =	-6.5000e+03
>> fmincon(f3, lb, A, b, Aeq, beq, lb, ub)
x =
	65.0000    2.1000   16.4500   16.4500
f =	16.4500
>> fmincon(f4, lb, A, b, Aeq, beq, lb, ub)
x =
	65.0000    2.1000   19.9000   13.0000
f =	15.0110
\end{lstlisting}

Таким образом, были получены следующие оптимальные значения:

\begin{enumerate}
	\item Доля белка: $21$.
	\item Общая калорийность: $6500$.
	\item Доля жира: $16.45$.
	\item Общая стоимость: $15.011$.
\end{enumerate}

\section{Переход от многокритериальной задачи к однокритериальной}

\subsection{Выделение главного критерия}

В данном методе выбирается один из критериев, например $C_i$, который наиболее полно отражает цель принятия решений. Остальные критерии учитываются только с точки зрения возможного указания их нижних границ $C_j(a) \geq \gamma_i$, $j \neq i$. Таким образом, исходная задача многокритериального принятия решений заменяется однокритериальной задачей с критерием $C_i$.

В данной задаче главным является критерий $f_4$ (стоимость всего продукта). Поэтому оптимум частного критерия $f_4$ из предыдущего пункта является решением задачи методом выделения главного критерия. Итоговые значения всех критериев:

\begin{enumerate}
	\item Доля белка: $13$ ($-38\%$ от максимальной).
	\item Общая калорийность: $5280$ ($-19\%$ от максимальной).
	\item Доля жира: $19.9$ ($+21\%$ от минимальной).
	\item Общая стоимость: $15.0110$ ($+0\%$ от минимальной).
\end{enumerate}

\subsection{Свертка критериев}

\subsubsection{Аддитивная свертка критериев}

Для использования метода аддитивной свертки необходимо выполнить нормировку критериев, с тем чтобы сделать их значения соизмеримыми, а единицы измерения – безразмерными. Выполним нормировку, поделив значение каждой целевой функции на ее оптимум.

Формула аддитивной свертки имеет вид:
$$
F(x) = \sum_{i=1}^{r}w_i f_i(x),\ 0<w_i<1,\ \sum_i w_i=1,
$$
где $f_i(x)$ - критерии оптимальности, $r$ – их общее число, а $w_i$ - параметры важности. 

Примем $w_1 = 0.3$, $w_2 = 0.2$, $w_3 = 0.2$, $w_4 = 0.3$, тем самым отдав предпочтение более высокой доли белка в продукте и более низкой стоимости.

\lstinputlisting[caption=\code{normalize.m}]{normalize.m}

\lstinputlisting[caption=\code{add.m}]{add.m}

\begin{lstlisting}[caption=\code{Console}]
>> add
>> [x, ~] = fmincon(f_add, lb, A, b, Aeq, beq, lb, ub)
x = 
	65.0000    2.1000   19.9000   13.0000
>> f1(x)
ans =
	-13.0000
>> f2(x)
ans =
	-5.2800e+03
>> f3(x)
ans =
	19.9000
>> f4(x)
ans =
	15.0110
\end{lstlisting}

Метод аддитивной свертки позволил получить решение:

\begin{enumerate}
	\item Доля белка: $13$ ($-38\%$ от максимальной).
	\item Общая калорийность: $5280$ ($-19\%$ от максимальной).
	\item Доля жира: $19.9$ ($+21\%$ от минимальной).
	\item Общая стоимость: $15.0110$ ($+0\%$ от минимальной).
\end{enumerate}

\subsubsection{Мультипликативная свертка критериев}

Формула мультипликативной свертки имеет вид:

$$
F(x) = \prod_{i=1}^{r} f_i(x)^{k_i},
$$
где $f_i(x)$ - критерии оптимальности, $r$ - их общее число, а $k_i$ - показатели важности. Примем аналогично аддитивной свертке $k_1 = 0.3$, $k_2 = 0.2$, $k_3 = 0.2$, $k_4 = 0.3$. Нормировка уже была произведена в аддитивной свертки, в итоге получим следующую задачу однокритериальной оптимизации:

$$
f = \overline{f_1}^{0.3} * \overline{f_2}^{0.2} * \overline{f_3}^{0.2} * \overline{f_4}^{0.3}
$$

\lstinputlisting[caption=\code{mult.m}]{mult.m}

\begin{lstlisting}[caption=\code{Console}]
>> mult
>> [x, ~] = fmincon(f_mult, lb, A, b, Aeq, beq, lb, ub)
x =
	65.0000    2.1000   19.9000   13.0000
>> f1(x)
ans =
	-13.0000
>> f2(x)
ans =
	-5.2800e+03
>> f3(x)
ans =
	19.9000
>> f4(x)
ans =
	15.0110
\end{lstlisting}

Из результатов видно, что оптимум мультипликативной свертки полностью совпал с оптимумом аддитивной свертки:

\begin{enumerate}
	\item Доля белка: $13$ ($-38\%$ от максимальной).
	\item Общая калорийность: $5280$ ($-19\%$ от максимальной).
	\item Доля жира: $19.9$ ($+21\%$ от минимальной).
	\item Общая стоимость: $15.0110$ ($+0\%$ от минимальной).
\end{enumerate}

\subsection{Минимакс (максимин)}

Максиминную свертку представим в следующем виде: $C_i(a)= \text{min } w_i C_i(a)$

Решение $a^*$ является наилучшим, если для всех $a$ выполняется условие $C(a^*) \geq C(a)$, или $a^* = \text{arg max } C(a) = \text{arg max min } w_i C_i (a)$.

Для реализации максиминной свертки необходимо в \code{funminmax} передавать функции, обратные целевым. Так как оцениваемые показатели разновелики, необходимо нормировать критерии.

\lstinputlisting[caption=\code{minmax.m}]{minmax.m}

\begin{lstlisting}[caption=\code{Console}]
>> minmax
>> [x, ~] = fminimax(f_minmax, lb, A, b, Aeq, beq, lb, ub)
x =
	65.0000    2.1000   18.1631   14.7369
>> f1(x)
ans =
	-14.7369
>> f2(x)
ans =
	-5.1063e+03
>> f3(x)
ans =
	18.1631
>> f4(x)
ans =
	16.5742
\end{lstlisting}

Из результатов видно, что метод минимакса оптимизировал целевые функции более равномерно, чем методы, основанные на свертке критериев:

\begin{enumerate}
	\item Доля белка: $14.7369$ ($-30\%$ от максимальной).
	\item Общая калорийность: $5106.3$ ($-21\%$ от максимальной).
	\item Доля жира: $18.1631$ ($+10\%$ от минимальной).
	\item Общая стоимость: $16.5742$ ($+10\%$ от минимальной).
\end{enumerate}

\subsection{Метод последовательных уступок}

Для решения данной задачи была выбрана уступка = 10\%. Пронумеруем критерии в следующем порядке важности:
$$
f_4 > f_1 > f_2 > f_3
$$

Для первого критерия уже решена задача поиска оптимального значения в разделе поиска оптимума частных критериев. В этом случае уступка:
$$
15.011 * 1.1 = 16.5121
$$

Тогда ограничение для критерия $f_4$ выглядит следующим образом:
$$
0.01 \cdot x_2 + 0.1 \cdot x_3 + 1 \cdot x_4 \leq 16.5121
$$

Добавим новое ограничение и найдем оптимум частного критерия $f_1$.

\lstinputlisting[caption=\code{concession1.m}]{concession1.m}

\begin{lstlisting}[caption=\code{Console}]
>> concession1
>> [x, z] = fmincon(f1, lb, A, b, Aeq, beq, lb, ub)
x =
	65.0000    2.1000   18.2321   14.6679
z =
	-14.6679
\end{lstlisting}

Для критерия $f_1$ был найден оптимум, доля белка была максимизирована -- $14.6679$, при условии ограничения на стоимость. В соответствии с полученным значением, сделаем уступку и введем ограничение для $f_1$.
$$
14.6679 * 0.9 = 13.20111
$$

Ограничения критерия выглядит следующим образом:
$$
-x_4 \leq -13.20111
$$

Добавим новое ограничение и найдем оптимум частного критерия $f_2$.

\lstinputlisting[caption=\code{concession2.m}]{concession2.m}

\begin{lstlisting}[caption=\code{Console}]
>> concession2
>> [x, z] = fmincon(f2, lb, A, b, Aeq, beq, lb, ub)
x =
	62.2724    1.4298   22.0000   14.2978
z =
	-5.8298e+03
\end{lstlisting}

Для критерия $f_2$ был найден оптимум, общая калорийность была максимизирована -- $5829.8$, при условии введенных ограничений. В соответствии с полученным значением, сделаем уступку и введем ограничение для $f_2$.
$$
5829.8 * 0.9 = 5246.82
$$

Ограничения критерия выглядит следующим образом:
$$
200 \cdot x_3 + 100 \cdot x_4 \leq 5246.82
$$

Добавим новое ограничение и найдем оптимум частного критерия $f_2$.

\lstinputlisting[caption=\code{concession3.m}]{concession3.m}

\begin{lstlisting}[caption=\code{Console}]
>> concession3
>> [x, z] = fmincon(f3, lb, A, b, Aeq, beq, lb, ub)
x =
	65.0000    2.1000   18.2321   14.6679
z =
	18.2321
\end{lstlisting}

Для критерия $f_3$ был найден оптимум, доля жира была минимизирована -- $18.2321$, при условии введенных ограничений. Итоговые результаты:

\begin{enumerate}
	\item Доля белка: $14.6679$ ($-30\%$ от максимальной).
	\item Общая калорийность: $5113.2$ ($-21\%$ от максимальной).
	\item Доля жира: $18.2321$ ($+11\%$ от минимальной).
	\item Общая стоимость: $16.5121$ ($+10\%$ от минимальной).
\end{enumerate}

Видно, что благодаря уступке на критерию стоимости, удалось увеличить долю белка и уменьшить общую калорийность.

\subsection{Метод достижения цели (fgoalattain)}

\code{fgoalattain} решает задачу достижения цели, которая является одной из формулировок
задач для векторной оптимизации: 

\noindent \code{x = fgoalattain(fun, x0, goal, weight, ...)}

\begin{itemize}
	\item \code{fun} -- целевая функция,
	\item \code{x0} -- начальные значения,
	\item \code{goal} -- целевые значения,
	\item \code{weight} -- веса.
\end{itemize}

Пусть \code{goal} = ($f_1^{min}, f_2^{min}, f_3^{min}, f_4^{min}$), а веса \code{weights} равны абсолютным значениям \code{abs(goal)}. Воспользуемся функцией \code{fgoalattain}:

\lstinputlisting[caption=\code{attainment.m}]{attainment.m}

\begin{lstlisting}[caption=\code{Console}]
>> attainment
>> [x, z, af] = fgoalattain(f, lb, goal, weights, A, b, Aeq, beq, lb, ub)
x =
	64.1392    2.0997   17.2731   16.4879
z =
	1.0e+03 *
	-0.0165   -5.1034    0.0173    0.0182
af =
	0.2149
\end{lstlisting}

Значение переменной \code{af}, говорит о том, что полученное решение на 21.49\% хуже поставленной цели. Итоговые значения критериев:

\begin{enumerate}
	\item Доля белка: $16.5$ ($-21\%$ от максимальной).
	\item Общая калорийность: $5103.4$ ($-21\%$ от максимальной).
	\item Доля жира: $17.3$ ($+5\%$ от минимальной).
	\item Общая стоимость: $18.2$ ($+21\%$ от минимальной).
\end{enumerate}

Сразу три критерия $f_1$, $f_2$ и $f_4$ отклонились от оптимума на 21\%, в то время как $f_3$ отклонился только на 5\%.

\subsection{Введение метрики в пространстве критериев}

Для перехода к однокритериальной задаче оптимизации методом введения метрики в пространстве целевых функций необходимо определить координаты «идеальной» точки $\alpha = (f_1^*, f_2^*, ..., f_r^*)$,  где $f_i^* = \min f_i(x)$. Эти значения были получены в разделе поиска оптимумов частных критериев:
$$
\alpha = (21,\ 6500,\ 16.45,\ 15.011)
$$

Введем в пространстве критериев метрику в виде евклидова расстояния:
$$
\rho(y, \alpha) = \sqrt{\sum_{i=1}^r(\alpha_i - y_i)^2}
$$

Тогда за целевую функцию (обобщенный критерий), с учетом необходимости нормировки, можно взять выражение:
$$
f = \sqrt{ \sum_{i=1}^r \left( \frac{\alpha_i-f_i}{f_i^*} \right)^2 } 
= \sqrt{ \sum_{i=1}^r \left( 1 - \frac{f_i}{f_i^*} \right)^2 }
$$

Реализуем целевую функцию.

\lstinputlisting[caption=\code{space.m}]{space.m}

\begin{lstlisting}[caption=\code{Console}]
>> space
>> [x, ~] = fmincon(f, lb, A, b, Aeq, beq, lb, ub)
x =
	64.2924    1.6313   17.7641   16.3122
>> f1(x)
ans =
	-16.3122
>> f2(x)
ans =
	-5.1840e+03
>> f3(x)
ans =
	17.7641
>> f4(x)
ans =
	18.1050
\end{lstlisting}

Итоговые значения критериев:

\begin{enumerate}
	\item Доля белка: $16.31$ ($-22\%$ от максимальной).
	\item Общая калорийность: $5184$ ($-20\%$ от максимальной).
	\item Доля жира: $17.7641$ ($+7\%$ от минимальной).
	\item Общая стоимость: $18.105$ ($+21\%$ от минимальной).
\end{enumerate}

Результаты оказались схожи с методом достижения цели.

\section{Оценка оптимальности по Парето}

Составим сводные таблицы с итоговыми значениями переменных и критериев для каждого из рассмотренных методов.

\begin{table}[H]
	\centering
	\caption{Итоговые значения переменных для каждого метода}
	\begin{tabular}{|l|c|c|c|c|}
		\hline
		\multicolumn{1}{|c|}{\textbf{Метод / Переменная}} & $x_1$   & $x_2$  & $x_3$   & $x_4$   \\ \hline
		1. Главного критерия          & 65      & 2.1    & 19.9    & 13      \\ \hline
		2.1. Аддитивной свертки       & 65      & 2.1    & 19.9    & 13      \\ \hline
		2.1. Мультипликативной свертки& 65      & 2.1    & 19.9    & 13      \\ \hline
		3. Минимакс                   & 65      & 2.1    & 18.1631 & 14.7369 \\ \hline
		4. Последовательных уступок   & 65      & 2.1    & 18.2321 & 14.6679 \\ \hline
		5. Достижения цели            & 64.1392 & 2.0997 & 17.2731 & 16.4879 \\ \hline
		6. Метрики в пространстве     & 64.2924 & 1.6313 & 17.7641 & 16.3122 \\ \hline
	\end{tabular}
\end{table}

\begin{table}[H]
	\centering
	\caption{Итоговые значения критериев для каждого метода}
	\begin{tabular}{|l|c|c|c|c|}
		\hline
		\multicolumn{1}{|c|}{\textbf{Метод / Критерий}} & $f_1$   & $f_2$  & $f_3$   & $f_4$   \\ \hline
		1. Главного критерия                 & 13      & 5280   & 19.9    & 15.011  \\ \hline
		2.1. Аддитивной свертки              & 13      & 5280   & 19.9    & 15.011  \\ \hline
		2.2. Мультипликативной свертки       & 13      & 5280   & 19.9    & 15.011  \\ \hline
		3. Минимакс                          & 14.7369 & 5106.3 & 18.1631 & 16.5742 \\ \hline
		4. Последовательных уступок          & 14.6679 & 5113.2 & 18.2321 & 16.5121 \\ \hline
		5. Достижения цели                   & 16.5    & 5103.4 & 17.3    & 18.2    \\ \hline
		6. Метрики в пространстве            & 16.31   & 5184   & 17.7641 & 18.105  \\ \hline
		\multicolumn{1}{|r|}{Оптимумы:}      & 21 $\uparrow$ & 6500 $\uparrow$ & 16.45 $\downarrow$ & 15.011 $\downarrow$ \\ \hline
	\end{tabular}
\end{table}

Решения, полученные всеми методами, формируют множество оптимальных решений по Парето, так как ни одно из них не является хуже (или таким же) любого другого решения одновременно по всем критериям: значение каждого частного показателя, характеризующего систему, не может быть улучшено без ухудшения других.

\end{document}
